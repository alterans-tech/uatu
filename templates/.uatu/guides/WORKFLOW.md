# Workflow Mechanics

**Purpose:** Naming conventions, folder structure, Jira tools, confirmation points.

---

## 1. Naming Conventions

### Worktree
```
{project}-{NNN}-{type}-{JIRA-KEY}-{description}
```

| Part | Description | Example |
|------|-------------|---------|
| project | Repository name | platform, rainbow, wbcx-director |
| NNN | Sequential index (global) | 010, 011, 012 |
| type | fix, feat, chore, refactor | fix |
| JIRA-KEY | Ticket ID | RED-2657 |
| description | Kebab-case summary | view-plan-button |

**Examples:**
```
platform-010-fix-RED-2657-view-plan-button
platform-013-feat-RED-2661-payment-modal
wbcx-director-001-fix-RED-2741-reserved-seating
```

### Branch
```
{JIRA-KEY}/{description}
```

**Examples:**
```
RED-2657/view-plan-button-hyperlink
RED-2661/modernize-payment-modal
RED-2741/reserved-seating-tables
```

### Feature Folder
```
{NNN}-{JIRA-KEY}-{short-name}
```

**Examples:**
```
010-RED-2657-view-plan-button
013-RED-2661-payment-modal
```

### Finding Next Index
```bash
# List all worktree directories for a project
ls -1d {project}-[0-9]* 2>/dev/null | sort -t'-' -k2 -n | tail -1
```

### Multi-Project Tasks
Use the SAME index across all projects:
```
platform-015-fix-RED-2700-cross-project
rainbow-015-fix-RED-2700-cross-project
```

---

## 2. Folder Structure

```
.uatu/
├── config/
│   ├── project.yaml        # Project configuration
│   └── constitution.md     # Project principles
├── guides/                 # These reference docs
│   ├── WORKFLOW.md
│   ├── SEQUENTIAL-THINKING.md
│   └── CLAUDE-FLOW-SELECTION.md
└── delivery/
    ├── research/           # General research (not task-specific)
    └── sprints/
        └── {YYYY-MM-DD-sprint-name}/
            └── features/
                └── {NNN}-{JIRA-KEY}-{short-name}/
                    ├── research.md       # If investigation needed
                    └── [speckit files]   # Only via /speckit.* commands
```

### Speckit Files (generated by /speckit.* commands)
| File | Purpose |
|------|---------|
| `spec.md` | Feature specification with user stories |
| `plan.md` | Technical implementation plan |
| `tasks.md` | Dependency-ordered task breakdown |
| `research.md` | Research findings and decisions |
| `data-model.md` | Data structures (if applicable) |
| `quickstart.md` | Test scenarios |
| `contracts/` | API endpoint definitions |
| `checklists/` | Requirements validation checklists |

**Do NOT create these manually.** Use speckit commands.

---

## 3. Speckit Commands

### Recommended Flow
```
/speckit.specify → /speckit.clarify → /speckit.plan → /speckit.tasks → /speckit.implement
```

### Command Reference

| Command | Purpose | Input | Output |
|---------|---------|-------|--------|
| `/speckit.specify` | Create feature spec | Feature description + JIRA key | `spec.md` |
| `/speckit.clarify` | Reduce ambiguity | Reads `spec.md` | Updates `spec.md` with answers |
| `/speckit.plan` | Technical planning | Reads `spec.md` | `plan.md`, `research.md`, `data-model.md`, `contracts/` |
| `/speckit.tasks` | Generate task list | Reads `spec.md` + `plan.md` | `tasks.md` |
| `/speckit.checklist` | Validate requirements | Domain (ux, security, etc.) | `checklists/{domain}.md` |
| `/speckit.analyze` | Cross-artifact check | All speckit files | Analysis report (read-only) |
| `/speckit.implement` | Execute tasks | Reads `tasks.md` | Code changes |
| `/speckit.taskstoissues` | Create GitHub issues | Reads `tasks.md` | GitHub issues |
| `/speckit.constitution` | Project principles | User input | `.specify/memory/constitution.md` |

### Usage Examples

**Start a new feature:**
```
/speckit.specify Add membership auto-renewal toggle RED-2571
```

**Clarify requirements:**
```
/speckit.clarify
```

**Generate implementation plan:**
```
/speckit.plan
```

**Create tasks:**
```
/speckit.tasks
```

**Generate checklist for specific domain:**
```
/speckit.checklist UX requirements for the toggle component
```

**Run consistency analysis:**
```
/speckit.analyze
```

**Start implementation:**
```
/speckit.implement
```

### Handoffs

Most commands offer handoff options after completion:

| After | Suggested Next |
|-------|---------------|
| `/speckit.specify` | `/speckit.clarify` or `/speckit.plan` |
| `/speckit.clarify` | `/speckit.plan` |
| `/speckit.plan` | `/speckit.tasks` or `/speckit.checklist` |
| `/speckit.tasks` | `/speckit.analyze` or `/speckit.implement` |
| `/speckit.analyze` | Fix issues, then `/speckit.implement` |

---

## 4. Jira MCP Tools

### CloudId
Every Jira tool requires `cloudId`. Get it:
```
mcp__atlassian__getAccessibleAtlassianResources()
```
Or use site URL directly: `yoursite.atlassian.net`

### Reading Issues
```
mcp__atlassian__getJiraIssue(cloudId, issueIdOrKey)
  → issueIdOrKey: "RED-2572" or "10000"
  → Returns: summary, description, status, priority, assignee
```

### Searching Issues
```
mcp__atlassian__search(query)
  → Unified search (recommended)

mcp__atlassian__searchJiraIssuesUsingJql(cloudId, jql, fields, maxResults)
  → JQL search (when specific syntax needed)
  → Example jql: "project = RED AND status = 'In Progress'"
```

### Adding Comments
```
mcp__atlassian__addCommentToJiraIssue(cloudId, issueIdOrKey, commentBody)
  → commentBody: Markdown format
```

### Transitioning Status
```
mcp__atlassian__getTransitionsForJiraIssue(cloudId, issueIdOrKey)
  → Get available transitions first

mcp__atlassian__transitionJiraIssue(cloudId, issueIdOrKey, transition)
  → transition: { id: "31" }  // ID from getTransitions
```

### Creating Issues
```
mcp__atlassian__createJiraIssue(cloudId, projectKey, issueTypeName, summary, description)
  → For subtasks: add parent parameter
```

### Other Useful Tools
| Tool | Purpose |
|------|---------|
| `editJiraIssue` | Update issue fields |
| `lookupJiraAccountId` | Find user by name/email |
| `getVisibleJiraProjects` | List accessible projects |
| `getJiraIssueRemoteIssueLinks` | Get linked Confluence pages |

---

## 5. Confirmation Points

### ALWAYS Confirm Before

| Action | Why |
|--------|-----|
| `git push` | User reviews changes first |
| `git commit` (significant) | Verify commit message |
| Jira comment | User approves content |
| Creating PR | User reviews PR description |
| Merging PR | Never merge without approval |
| Deleting files | Destructive action |
| Database changes | High risk |
| Transitioning Jira status | Workflow impact |

### Confirmation Format
```
Ready to [action]:
- [detail 1]
- [detail 2]

Proceed? (yes/no)
```

### No Confirmation Needed
- Reading files
- Searching codebase
- Running tests (non-destructive)
- Creating feature folder
- Writing research.md

---

## 6. Worktree Workflow

### When to Use Worktrees

Git worktrees provide isolated working environments for features without switching branches in your main repository.

**Use worktrees when:**
- Working on existing projects with established git history
- Need to work on multiple features simultaneously
- Want to preserve work-in-progress without stashing
- Working on long-running features that span multiple sessions

**Work directly in master when:**
- Starting a brand new project (no git history yet)
- Working on scratch/prototype code
- Project setup and initial configuration
- Until `.uatu/config/project.md` exists (indicates established project)

### Detection

Use the worktree helper to check your current status:
```bash
.uatu/tools/worktree-helper.sh
```

This will tell you:
- Whether you're in a git repository
- If worktrees are being used
- Recommendation for your project state

### Creating a Worktree for a Jira Task

When starting work on a Jira task in an existing project:

1. **Get the next index number:**
   ```bash
   # Find the highest existing index
   ls -1d {project}-[0-9]* 2>/dev/null | sort -t'-' -k2 -n | tail -1
   ```

2. **Create the worktree:**
   ```bash
   # Format: {project}-{NNN}-{type}-{JIRA-KEY}-{description}
   git worktree add platform-015-feat-RED-2700-user-dashboard \
     -b RED-2700/user-dashboard
   ```

3. **Navigate to the worktree:**
   ```bash
   cd platform-015-feat-RED-2700-user-dashboard
   ```

4. **Verify you're in the worktree:**
   ```bash
   git worktree list
   git branch --show-current
   ```

### Worktree Naming Convention

```
{project}-{NNN}-{type}-{JIRA-KEY}-{description}
```

| Part | Description | Example |
|------|-------------|---------|
| project | Repository name | platform, rainbow, wbcx-director |
| NNN | Sequential index (global) | 010, 011, 012 |
| type | fix, feat, chore, refactor | feat |
| JIRA-KEY | Ticket ID | RED-2700 |
| description | Kebab-case summary | user-dashboard |

The branch name follows the simpler format: `{JIRA-KEY}/{description}`

### Working with Worktrees

**List all worktrees:**
```bash
git worktree list
```

**Switch between worktrees:**
```bash
# Just cd to the worktree directory
cd ../platform-015-feat-RED-2700-user-dashboard
```

**Check current worktree status:**
```bash
git status
git branch --show-current
```

**Push from a worktree:**
```bash
git push -u origin RED-2700/user-dashboard
```

### Cleaning Up Worktrees

After merging and completing work:

```bash
# Remove the worktree
git worktree remove platform-015-feat-RED-2700-user-dashboard

# Delete the branch (if no longer needed)
git branch -d RED-2700/user-dashboard

# If branch was merged remotely, delete remote branch
git push origin --delete RED-2700/user-dashboard
```

### Multi-Project Tasks

When working across multiple repositories, use the SAME index:
```
platform-015-fix-RED-2700-cross-project
rainbow-015-fix-RED-2700-cross-project
```

This maintains consistency and makes it clear these worktrees are related.

---

## 7. Git Operations

### Create Worktree
```bash
git worktree add {project}-{NNN}-{type}-{JIRA-KEY}-{description} -b {JIRA-KEY}/{description}
```

### Remove Worktree
```bash
git worktree remove {worktree-path}
git branch -d {branch-name}  # if branch no longer needed
```

### List Worktrees
```bash
git worktree list
```

---

## 8. Quick Reference

| What | Format |
|------|--------|
| Worktree | `{project}-{NNN}-{type}-{JIRA-KEY}-{description}` |
| Branch | `{JIRA-KEY}/{description}` |
| Feature folder | `{NNN}-{JIRA-KEY}-{short-name}` |
| Index scope | Global (not per-sprint) |

---

*Mechanics reference v3.0*
